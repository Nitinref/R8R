version: '3.8'

services:
  redis:
    image: redis:7-alpine
    ports: ["6379:6379"]
    volumes: [redis_data:/data]
    command: redis-server --appendonly yes

  qdrant:
    image: qdrant/qdrant:latest
    ports: ["6333:6333", "6334:6334"]
    volumes: [qdrant_data:/storage]

  backend:
    build:
      context: .
      dockerfile: docker/Dockerfile.backend
    ports: ["3001:3001"]
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=redis://redis:6379
      - QDRANT_URL=http://qdrant:6333
    depends_on: [redis, qdrant]

  frontend:
    build:
      context: .
      dockerfile: docker/Dockerfile.frontend
    ports: ["3000:3000"]
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - NEXT_PUBLIC_API_URL=http://localhost:3001
    depends_on: [backend]

volumes:
  redis_data:
  qdrant_data: